#!/usr/bin/env php
<?php
/**
 * Simple script that extract all the code blocks from the README and evaluates
 * them. Used to ensure that the examples in the README are working fine.
 */

require_once __DIR__ . '/../vendor/autoload.php';

if (preg_match_all('/```php([^`]+)```/', file_get_contents(__DIR__ . '/../README.md'), $matches)) {
	try {
		foreach ($matches[1] as $code_block) {
			eval(\preg_replace('/^>\s*/m', '', $code_block));
		}
	}
	catch (\Throwable $e) {
		fwrite(STDERR, "{$code_block}\n");
		fwrite(STDERR, "{$e->getTraceAsString()}\n\n");
		fwrite(STDERR, str_repeat('-', 80));
		fwrite(STDERR, "\n");
	}
}
